<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>长视频理解能力分析可视化</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:ital,wght@0,400;0,600;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">

    <!-- Markdown 渲染 -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- JSON 树视图 -->
    <script src="https://cdn.jsdelivr.net/npm/renderjson@1.4.0/renderjson.js"></script>

    <style>
        :root {
            --color-text: #1a1a1a;
            --color-text-secondary: #555;
            --color-text-muted: #888;
            --color-bg: #ffffff;
            --color-bg-alt: #f8f9fa;
            --color-border: #e5e5e5;
            --color-accent: #2563eb;
            --color-accent-light: #dbeafe;

            /* 能力颜色 */
            --color-visual: #4CAF50;
            --color-temporal: #2196F3;
            --color-reasoning: #F44336;
            --color-spatial: #FF9800;
            --color-audiovisual: #9C27B0;
            --color-highlight: #FFF9C4;

            --font-serif: 'Crimson Pro', 'Noto Sans SC', serif;
            --font-sans: 'Noto Sans SC', -apple-system, sans-serif;
            --font-mono: 'JetBrains Mono', monospace;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font-sans);
            font-size: 16px;
            line-height: 1.6;
            color: var(--color-text);
            background: var(--color-bg);
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
            border-bottom: 1px solid var(--color-border);
            padding: 3rem 2rem 2.5rem;
            text-align: center;
        }

        .header-tag {
            display: inline-block;
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--color-accent);
            background: var(--color-accent-light);
            padding: 0.25rem 0.75rem;
            border-radius: 2rem;
            margin-bottom: 1rem;
        }

        .header h1 {
            font-family: var(--font-serif);
            font-size: clamp(1.75rem, 4vw, 2.5rem);
            font-weight: 700;
            color: var(--color-text);
            margin-bottom: 0.5rem;
        }

        .header .subtitle {
            font-size: 1rem;
            color: var(--color-text-secondary);
            font-weight: 400;
        }

        /* Main Content */
        .main {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem 1.5rem 4rem;
        }

        /* Section */
        .section {
            margin-bottom: 3rem;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--color-text);
        }

        .section-number {
            font-family: var(--font-serif);
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--color-accent);
            line-height: 1;
        }

        .section-title {
            font-family: var(--font-serif);
            font-size: 1.25rem;
            font-weight: 600;
        }

        .section-count {
            margin-left: auto;
            font-size: 0.875rem;
            color: var(--color-text-muted);
        }

        /* ========== 能力分类概览表格 ========== */
        .ability-overview-table {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1px;
            background: var(--color-border);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            overflow: hidden;
        }

        .ability-column {
            background: var(--color-bg);
            display: flex;
            flex-direction: column;
        }

        .ability-header {
            padding: 1rem;
            text-align: center;
            border-bottom: 1px solid var(--color-border);
        }

        .ability-icon {
            font-size: 1.25rem;
            margin-bottom: 0.25rem;
        }

        .ability-name-zh {
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 0.125rem;
        }

        .ability-name-en {
            font-size: 0.75rem;
            color: var(--color-text-muted);
        }

        .ability-skills {
            padding: 1rem;
            flex: 1;
            border-bottom: 1px solid var(--color-border);
        }

        .ability-skills ul {
            list-style: none;
            font-size: 0.85rem;
        }

        .ability-skills li {
            padding: 0.25rem 0;
            padding-left: 1rem;
            position: relative;
        }

        .ability-skills li::before {
            content: "•";
            position: absolute;
            left: 0;
            font-weight: bold;
        }

        .ability-examples {
            padding: 1rem;
            background: var(--color-bg-alt);
            font-size: 0.8rem;
            color: var(--color-text-secondary);
        }

        .ability-examples p {
            margin-bottom: 0.5rem;
        }

        .ability-examples p:last-child {
            margin-bottom: 0;
        }

        .ability-examples .icon {
            margin-right: 0.25rem;
        }

        /* 能力颜色标记 */
        .ability-column[data-ability="visual_perception"] .ability-header {
            border-top: 3px solid var(--color-visual);
        }
        .ability-column[data-ability="visual_perception"] .ability-skills li::before {
            color: var(--color-visual);
        }

        .ability-column[data-ability="temporal_dynamics"] .ability-header {
            border-top: 3px solid var(--color-temporal);
        }
        .ability-column[data-ability="temporal_dynamics"] .ability-skills li::before {
            color: var(--color-temporal);
        }

        .ability-column[data-ability="high_level_reasoning"] .ability-header {
            border-top: 3px solid var(--color-reasoning);
        }
        .ability-column[data-ability="high_level_reasoning"] .ability-skills li::before {
            color: var(--color-reasoning);
        }

        .ability-column[data-ability="spatial_object_dynamics"] .ability-header {
            border-top: 3px solid var(--color-spatial);
        }
        .ability-column[data-ability="spatial_object_dynamics"] .ability-skills li::before {
            color: var(--color-spatial);
        }

        .ability-column[data-ability="audiovisual_joint"] .ability-header {
            border-top: 3px solid var(--color-audiovisual);
        }
        .ability-column[data-ability="audiovisual_joint"] .ability-skills li::before {
            color: var(--color-audiovisual);
        }

        /* ========== 能力筛选器 ========== */
        .filter-section {
            background: var(--color-bg-alt);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            padding: 1.25rem 1.5rem;
            margin-bottom: 2rem;
        }

        .filter-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .filter-title {
            font-weight: 600;
            font-size: 0.95rem;
        }

        .filter-clear {
            font-size: 0.8rem;
            color: var(--color-accent);
            cursor: pointer;
            text-decoration: none;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .filter-clear:hover {
            background: var(--color-accent-light);
        }

        .filter-buttons {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .filter-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border: 2px solid var(--color-border);
            border-radius: 6px;
            background: var(--color-bg);
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.875rem;
        }

        .filter-btn .checkbox {
            width: 16px;
            height: 16px;
            border: 2px solid currentColor;
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .filter-btn .checkbox::after {
            content: "✓";
            font-size: 10px;
            opacity: 0;
            transform: scale(0);
            transition: all 0.2s;
        }

        .filter-btn.active .checkbox {
            background: currentColor;
        }

        .filter-btn.active .checkbox::after {
            opacity: 1;
            transform: scale(1);
            color: white;
        }

        .filter-btn[data-ability="visual_perception"] {
            color: var(--color-visual);
        }
        .filter-btn[data-ability="visual_perception"].active {
            background: rgba(76, 175, 80, 0.1);
            border-color: var(--color-visual);
        }

        .filter-btn[data-ability="temporal_dynamics"] {
            color: var(--color-temporal);
        }
        .filter-btn[data-ability="temporal_dynamics"].active {
            background: rgba(33, 150, 243, 0.1);
            border-color: var(--color-temporal);
        }

        .filter-btn[data-ability="high_level_reasoning"] {
            color: var(--color-reasoning);
        }
        .filter-btn[data-ability="high_level_reasoning"].active {
            background: rgba(244, 67, 54, 0.1);
            border-color: var(--color-reasoning);
        }

        .filter-btn[data-ability="spatial_object_dynamics"] {
            color: var(--color-spatial);
        }
        .filter-btn[data-ability="spatial_object_dynamics"].active {
            background: rgba(255, 152, 0, 0.1);
            border-color: var(--color-spatial);
        }

        .filter-btn[data-ability="audiovisual_joint"] {
            color: var(--color-audiovisual);
        }
        .filter-btn[data-ability="audiovisual_joint"].active {
            background: rgba(156, 39, 176, 0.1);
            border-color: var(--color-audiovisual);
        }

        .filter-status {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 1rem;
            padding-top: 0.75rem;
            border-top: 1px solid var(--color-border);
            font-size: 0.85rem;
            color: var(--color-text-secondary);
        }

        .filter-status-counts {
            display: flex;
            gap: 1.5rem;
        }

        .filter-status-counts span {
            font-weight: 500;
        }

        /* ========== 论文方法展示区 ========== */
        .paper-card {
            border: 1px solid var(--color-border);
            border-radius: 8px;
            margin-bottom: 1.5rem;
            overflow: hidden;
            transition: opacity 0.3s, transform 0.3s;
        }

        .paper-card.hidden {
            display: none;
        }

        .paper-header {
            background: var(--color-bg-alt);
            padding: 0.75rem 1.25rem;
            border-bottom: 1px solid var(--color-border);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .paper-icon {
            font-size: 1.1rem;
        }

        .paper-name {
            font-weight: 600;
            font-size: 1rem;
        }

        .paper-full-name {
            font-size: 0.85rem;
            color: var(--color-text-secondary);
            text-decoration: none;
            margin-left: 0.5rem;
            padding-left: 0.75rem;
            border-left: 1px solid var(--color-border);
            transition: color 0.2s;
        }

        .paper-full-name:hover {
            color: var(--color-accent);
            text-decoration: underline;
        }

        .paper-info-grid {
            display: grid;
            grid-template-columns: 180px 1fr 180px 120px 1fr 150px;
            border-bottom: 1px solid var(--color-border);
        }

        /* 方法图缩略图 */
        .paper-thumbnail {
            max-height: 80px;
            max-width: 100%;
            width: auto;
            object-fit: contain;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .paper-thumbnail:hover {
            transform: scale(1.05);
        }

        .no-image {
            color: var(--color-text-muted);
            font-size: 0.8rem;
        }

        /* 图片 Modal 弹窗 */
        .image-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1000;
        }

        .image-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .image-modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
        }

        .image-modal-content {
            position: relative;
            max-width: 90vw;
            max-height: 90vh;
        }

        .image-modal-content img {
            max-width: 90vw;
            max-height: 90vh;
            object-fit: contain;
        }

        .image-modal-close {
            position: absolute;
            top: -40px;
            right: 0;
            background: none;
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            padding: 0.5rem;
            line-height: 1;
        }

        .image-modal-close:hover {
            color: #ccc;
        }

        .paper-info-cell {
            padding: 0.75rem 1rem;
            border-right: 1px solid var(--color-border);
            font-size: 0.85rem;
        }

        .paper-info-cell:last-child {
            border-right: none;
        }

        .paper-info-label {
            font-size: 0.75rem;
            color: var(--color-text-muted);
            margin-bottom: 0.25rem;
            font-weight: 500;
        }

        .paper-info-value {
            color: var(--color-text);
            line-height: 1.4;
        }

        .paper-info-value ul {
            list-style: none;
            font-size: 0.8rem;
        }

        .paper-info-value li {
            padding-left: 0.75rem;
            position: relative;
        }

        .paper-info-value li::before {
            content: "•";
            position: absolute;
            left: 0;
            color: var(--color-accent);
        }

        /* Tools & Memory 区域 */
        .tools-memory-section {
            padding: 1rem 1.25rem;
        }

        .tools-memory-header {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--color-text-muted);
            margin-bottom: 0.75rem;
        }

        .tools-memory-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
        }

        /* Tool 卡片 */
        .tool-card {
            width: 280px;
            border: 1px solid var(--color-border);
            border-radius: 6px;
            background: var(--color-bg);
            font-size: 0.8rem;
            transition: all 0.3s;
            flex-shrink: 0;
        }

        .tool-card.highlighted {
            background: var(--color-highlight);
            border-color: #fde047;
            order: -1;
        }

        .tool-card-header {
            padding: 0.5rem 0.75rem;
            border-bottom: 1px solid var(--color-border);
            display: flex;
            align-items: center;
            gap: 0.375rem;
            font-weight: 600;
        }

        .tool-card.highlighted .tool-card-header {
            border-bottom-color: #fde047;
        }

        .tool-card-body {
            padding: 0.5rem 0.75rem;
        }

        .tool-card-row {
            display: flex;
            margin-bottom: 0.25rem;
            align-items: flex-start;
        }

        .tool-card-row:last-child {
            margin-bottom: 0;
        }

        .tool-card-label {
            color: var(--color-text-muted);
            width: 45px;
            flex-shrink: 0;
        }

        .tool-card-value {
            flex: 1;
            word-wrap: break-word;
            word-break: break-word;
        }

        .tool-card-abilities {
            padding: 0.375rem 0.75rem;
            border-top: 1px solid var(--color-border);
            display: flex;
            flex-wrap: wrap;
            gap: 0.25rem;
        }

        .tool-card.highlighted .tool-card-abilities {
            border-top-color: #fde047;
        }

        /* Memory 卡片 */
        .memory-card {
            width: 280px;
            border: 1px solid var(--color-border);
            border-radius: 6px;
            background: var(--color-bg);
            font-size: 0.8rem;
            transition: all 0.3s;
            flex-shrink: 0;
        }

        .memory-card.highlighted {
            background: var(--color-highlight);
            border-color: #fde047;
            order: -1;
        }

        .memory-card-header {
            padding: 0.5rem 0.75rem;
            border-bottom: 1px solid var(--color-border);
            display: flex;
            align-items: center;
            gap: 0.375rem;
            font-weight: 600;
        }

        .memory-card.highlighted .memory-card-header {
            border-bottom-color: #fde047;
        }

        .memory-card-body {
            padding: 0.5rem 0.75rem;
        }

        .memory-card-row {
            display: flex;
            margin-bottom: 0.25rem;
            align-items: flex-start;
        }

        .memory-card-row:last-child {
            margin-bottom: 0;
        }

        .memory-card-label {
            color: var(--color-text-muted);
            width: 45px;
            flex-shrink: 0;
        }

        .memory-card-value {
            flex: 1;
            word-wrap: break-word;
            word-break: break-word;
        }

        .memory-card-abilities {
            padding: 0.375rem 0.75rem;
            border-top: 1px solid var(--color-border);
            display: flex;
            flex-wrap: wrap;
            gap: 0.25rem;
        }

        .memory-card.highlighted .memory-card-abilities {
            border-top-color: #fde047;
        }

        /* 能力标签 */
        .ability-tag {
            display: inline-block;
            padding: 0.125rem 0.375rem;
            border-radius: 3px;
            font-size: 0.7rem;
            font-weight: 500;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .ability-tag:hover {
            transform: scale(1.05);
        }

        .ability-tag[data-ability="visual_perception"] {
            background: rgba(76, 175, 80, 0.15);
            color: var(--color-visual);
        }

        .ability-tag[data-ability="temporal_dynamics"] {
            background: rgba(33, 150, 243, 0.15);
            color: var(--color-temporal);
        }

        .ability-tag[data-ability="high_level_reasoning"] {
            background: rgba(244, 67, 54, 0.15);
            color: var(--color-reasoning);
        }

        .ability-tag[data-ability="spatial_object_dynamics"] {
            background: rgba(255, 152, 0, 0.15);
            color: var(--color-spatial);
        }

        .ability-tag[data-ability="audiovisual_joint"] {
            background: rgba(156, 39, 176, 0.15);
            color: var(--color-audiovisual);
        }

        /* ========== Case 展示区 ========== */
        .case-card {
            border: 1px solid var(--color-border);
            border-radius: 8px;
            margin-bottom: 1.5rem;
            overflow: hidden;
            transition: opacity 0.3s, transform 0.3s;
        }

        .case-card.hidden {
            display: none;
        }

        .case-header {
            background: var(--color-bg-alt);
            padding: 0.75rem 1.25rem;
            border-bottom: 1px solid var(--color-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .case-header-left {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .case-icon {
            font-size: 1.1rem;
        }

        .case-id {
            font-weight: 600;
            font-size: 1rem;
        }

        .case-header-right {
            display: flex;
            gap: 0.75rem;
        }

        .case-link {
            color: var(--color-accent);
            text-decoration: none;
            font-size: 1.1rem;
            transition: transform 0.2s;
        }

        .case-link:hover {
            transform: scale(1.1);
        }

        .case-body {
            padding: 1.25rem;
        }

        /* 基础信息区 */
        .case-info-section {
            margin-bottom: 1.25rem;
        }

        .case-info-grid {
            display: grid;
            grid-template-columns: 180px 180px 1fr;
            gap: 1px;
            background: var(--color-border);
            border: 1px solid var(--color-border);
            border-radius: 6px;
            overflow: hidden;
        }

        .case-info-cell {
            background: var(--color-bg);
            padding: 0.75rem 1rem;
        }

        .case-info-label {
            font-size: 0.75rem;
            color: var(--color-text-muted);
            margin-bottom: 0.25rem;
            font-weight: 500;
        }

        .case-info-value {
            font-size: 0.85rem;
            color: var(--color-text);
        }

        /* 分类信息字段样式 */
        .case-info-field {
            display: flex;
            margin-bottom: 0.35rem;
        }

        .case-info-field:last-child {
            margin-bottom: 0;
        }

        .case-info-field-name {
            color: var(--color-text-muted);
            font-size: 0.8rem;
            min-width: 75px;
            flex-shrink: 0;
        }

        .case-info-field-value {
            color: var(--color-text);
            font-weight: 500;
        }

        .case-question-cell {
            grid-row: span 2;
        }

        .case-question {
            font-weight: 600;
            margin-bottom: 0.75rem;
            line-height: 1.5;
        }

        .case-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .case-option {
            font-size: 0.85rem;
            padding: 0.25rem 0.5rem;
            background: var(--color-bg-alt);
            border-radius: 4px;
        }

        .case-option.correct {
            background: rgba(76, 175, 80, 0.15);
            font-weight: 500;
        }

        .case-option.correct::after {
            content: " ✓";
            color: var(--color-visual);
        }

        .case-abilities {
            display: flex;
            flex-wrap: wrap;
            gap: 0.375rem;
            margin-top: 0.5rem;
        }

        .case-abilities-label {
            font-size: 0.75rem;
            color: var(--color-text-muted);
            margin-right: 0.25rem;
        }

        /* 推理对照区 */
        .case-reasoning-section {
            margin-bottom: 1.25rem;
        }

        .reasoning-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .reasoning-column {
            border: 1px solid var(--color-border);
            border-radius: 6px;
            overflow: hidden;
        }

        .reasoning-header {
            background: var(--color-bg-alt);
            padding: 0.5rem 0.75rem;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--color-text-secondary);
            border-bottom: 1px solid var(--color-border);
        }

        .reasoning-content {
            padding: 0.75rem;
            font-size: 0.85rem;
            line-height: 1.6;
            max-height: 150px;
            overflow-y: auto;
        }

        .reasoning-content.placeholder {
            color: var(--color-text-muted);
            font-style: italic;
        }

        /* 字幕和 Plan 区域 - 两栏布局 */
        .case-subtitle-plan-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        /* 字幕区 */
        .case-subtitle-section {
            border: 1px solid var(--color-border);
            border-radius: 6px;
            overflow: hidden;
        }

        .subtitle-header {
            background: var(--color-bg-alt);
            padding: 0.5rem 0.75rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            transition: background 0.2s;
        }

        .subtitle-header:hover {
            background: #eef2ff;
        }

        .subtitle-title {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--color-text-secondary);
        }

        .subtitle-toggle {
            font-size: 0.75rem;
            color: var(--color-accent);
        }

        .subtitle-content {
            display: none;
            padding: 0.75rem;
            font-size: 0.8rem;
            line-height: 1.6;
            max-height: 200px;
            overflow-y: auto;
            color: var(--color-text-secondary);
            font-family: var(--font-mono);
            white-space: pre-wrap;
        }

        .subtitle-content.expanded {
            display: block;
        }

        .subtitle-preview {
            padding: 0.5rem 0.75rem;
            font-size: 0.8rem;
            color: var(--color-text-muted);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            border-top: 1px solid var(--color-border);
        }

        .subtitle-preview.hidden {
            display: none;
        }

        /* Plan 区域样式 */
        .case-plan-section {
            border: 1px solid var(--color-border);
            border-radius: 6px;
            overflow: hidden;
        }

        .plan-header {
            background: var(--color-bg-alt);
            padding: 0.5rem 0.75rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .plan-title {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--color-text-secondary);
        }

        .plan-content {
            padding: 0.75rem;
            font-size: 0.8rem;
            line-height: 1.6;
            max-height: 300px;
            overflow-y: auto;
        }

        .plan-content.placeholder {
            color: var(--color-text-muted);
            font-style: italic;
        }

        .plan-task {
            font-weight: 600;
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--color-border);
        }

        .plan-steps {
            list-style: none;
        }

        .plan-step {
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            background: var(--color-bg-alt);
            border-radius: 4px;
            border-left: 3px solid var(--color-accent);
        }

        .plan-step-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.25rem;
        }

        .plan-step-number {
            background: var(--color-accent);
            color: white;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 600;
            flex-shrink: 0;
        }

        .plan-step-desc {
            font-weight: 500;
            color: var(--color-text);
        }

        .plan-step-details {
            margin-left: 26px;
            font-size: 0.75rem;
            color: var(--color-text-secondary);
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 0.5rem;
        }

        .plan-step-tool {
            display: inline-block;
            background: rgba(37, 99, 235, 0.1);
            color: var(--color-accent);
            padding: 0.125rem 0.375rem;
            border-radius: 3px;
            font-family: var(--font-mono);
            font-size: 0.7rem;
        }

        .plan-step-purpose {
            flex: 1;
            min-width: 150px;
        }

        .plan-step-dep {
            color: var(--color-text-muted);
            font-size: 0.7rem;
            background: var(--color-bg);
            padding: 0.125rem 0.375rem;
            border-radius: 3px;
        }

        .plan-step-io {
            margin-left: 26px;
            margin-top: 0.375rem;
            padding: 0.375rem 0.5rem;
            background: var(--color-bg);
            border-radius: 4px;
            border: 1px dashed var(--color-border);
            font-size: 0.7rem;
        }

        .plan-io-row {
            display: flex;
            margin-bottom: 0.25rem;
        }

        .plan-io-row:last-child {
            margin-bottom: 0;
        }

        .plan-io-label {
            color: var(--color-text-muted);
            min-width: 36px;
            flex-shrink: 0;
            font-weight: 500;
        }

        .plan-io-value {
            color: var(--color-text-secondary);
            font-family: var(--font-mono);
            word-break: break-word;
        }

        .plan-tool-chain {
            margin-top: 0.75rem;
            padding-top: 0.5rem;
            border-top: 1px solid var(--color-border);
            font-size: 0.75rem;
            color: var(--color-text-muted);
        }

        .plan-tool-chain-label {
            font-weight: 500;
            margin-right: 0.5rem;
        }

        /* ========== 实验模板面板 ========== */
        .experiment-panels {
            margin-bottom: 1.5rem;
        }

        .experiment-panel {
            border: 1px solid var(--color-border);
            border-radius: 6px;
            margin-bottom: 0.5rem;
            overflow: hidden;
        }

        /* 分层 21 工具集面板 - 蓝色系 */
        .experiment-panel[data-experiment-id="exp_001_baseline"] {
            border-color: #7ba3d4;
        }
        .experiment-panel[data-experiment-id="exp_001_baseline"] .experiment-panel-header {
            background: #4b6cb7;
            color: #fff;
        }
        .experiment-panel[data-experiment-id="exp_001_baseline"] .experiment-panel-header:hover {
            background: #3b5998;
        }
        .experiment-panel[data-experiment-id="exp_001_baseline"] .experiment-panel-toggle {
            color: rgba(255,255,255,0.7);
        }

        /* UniVA 面板 - 灰色系 */
        .experiment-panel[data-experiment-id="univa"] {
            border-color: #d1d5db;
        }
        .experiment-panel[data-experiment-id="univa"] .experiment-panel-header {
            background: #9ca3af;
            color: #fff;
        }
        .experiment-panel[data-experiment-id="univa"] .experiment-panel-header:hover {
            background: #8b939e;
        }
        .experiment-panel[data-experiment-id="univa"] .experiment-panel-toggle {
            color: rgba(255,255,255,0.7);
        }

        .experiment-panel-header {
            background: var(--color-bg-alt);
            padding: 0.6rem 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            transition: background 0.2s;
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--color-text-secondary);
        }

        .experiment-panel-header:hover {
            background: #eef2ff;
        }

        .experiment-panel-toggle {
            font-size: 0.75rem;
            color: var(--color-accent);
        }

        .experiment-panel-body {
            display: none;
            height: 400px;
            overflow-y: auto;
            padding: 1rem;
            border-top: 1px solid var(--color-border);
            font-size: 0.85rem;
            line-height: 1.7;
        }

        .experiment-panel-body.expanded {
            display: block;
        }

        .experiment-panel-body h1,
        .experiment-panel-body h2,
        .experiment-panel-body h3,
        .experiment-panel-body h4 {
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            color: var(--color-text);
        }

        .experiment-panel-body h1 { font-size: 1.1rem; }
        .experiment-panel-body h2 { font-size: 1rem; }
        .experiment-panel-body h3 { font-size: 0.9rem; }
        .experiment-panel-body h4 { font-size: 0.85rem; }

        .experiment-panel-body ul,
        .experiment-panel-body ol {
            padding-left: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .experiment-panel-body li {
            margin-bottom: 0.25rem;
        }

        .experiment-panel-body p {
            margin-bottom: 0.5rem;
        }

        .experiment-panel-body hr {
            border: none;
            border-top: 1px solid var(--color-border);
            margin: 0.75rem 0;
        }

        .experiment-panel-body code {
            font-family: var(--font-mono);
            font-size: 0.8rem;
            background: var(--color-bg-alt);
            padding: 0.1rem 0.3rem;
            border-radius: 3px;
        }

        /* 工具标注行（提示词模板中，标签在工具前） */
        .tool-annotation-line {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 0.25rem;
            margin-bottom: 0.15rem;
            margin-top: 0.5rem;
        }

        /* 来源标签 */
        .source-tag {
            display: inline-flex;
            align-items: center;
            padding: 0.1rem 0.4rem;
            border-radius: 3px;
            font-size: 0.7rem;
            font-weight: 500;
            background: rgba(37, 99, 235, 0.08);
            color: var(--color-accent);
            cursor: pointer;
            transition: background 0.2s;
            white-space: nowrap;
        }

        .source-tag:hover {
            background: rgba(37, 99, 235, 0.18);
        }

        /* 能力标签（plan/模板中的小号标签） */
        .plan-ability-tag {
            display: inline-flex;
            align-items: center;
            padding: 0.1rem 0.35rem;
            border-radius: 3px;
            font-size: 0.65rem;
            font-weight: 500;
            cursor: pointer;
            transition: opacity 0.2s;
            white-space: nowrap;
        }

        .plan-ability-tag:hover {
            opacity: 0.8;
        }

        .plan-ability-tag[data-ability="visual_perception"] { background: rgba(76, 175, 80, 0.15); color: #2e7d32; }
        .plan-ability-tag[data-ability="temporal_dynamics"] { background: rgba(33, 150, 243, 0.15); color: #1565c0; }
        .plan-ability-tag[data-ability="high_level_reasoning"] { background: rgba(244, 67, 54, 0.15); color: #c62828; }
        .plan-ability-tag[data-ability="spatial_object_dynamics"] { background: rgba(255, 152, 0, 0.15); color: #e65100; }
        .plan-ability-tag[data-ability="audiovisual_joint"] { background: rgba(156, 39, 176, 0.15); color: #6a1b9a; }

        /* ========== Plan 对比区 ========== */
        .plan-comparison-header {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--color-text-secondary);
            margin: 0.75rem 0 0.5rem;
            padding-bottom: 0.35rem;
            border-bottom: 1px solid var(--color-border);
        }

        .case-plan-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .plan-column {
            border: 1px solid var(--color-border);
            border-radius: 6px;
            overflow: hidden;
        }

        /* 分层 21 工具集（主角）外层样式 */
        .plan-column[data-experiment-id="exp_001_baseline"] {
            border: 2px solid #7ba3d4;
            background: #f8faff;
        }

        /* UniVA（参照）外层样式 */
        .plan-column[data-experiment-id="univa"] {
            border: 1px solid #d1d5db;
            background: #fafafa;
        }

        .plan-column-header {
            padding: 0.5rem 0.75rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--color-border);
        }

        /* 分层 21 列头 - 深蓝 */
        .plan-column[data-experiment-id="exp_001_baseline"] .plan-column-header {
            background: #4b6cb7;
            border-bottom-color: #4b6cb7;
        }
        .plan-column[data-experiment-id="exp_001_baseline"] .plan-column-title {
            color: #fff;
        }
        .plan-column[data-experiment-id="exp_001_baseline"] .plan-column-model {
            color: rgba(255,255,255,0.7);
        }

        /* UniVA 列头 - 中灰 */
        .plan-column[data-experiment-id="univa"] .plan-column-header {
            background: #9ca3af;
            border-bottom-color: #9ca3af;
        }
        .plan-column[data-experiment-id="univa"] .plan-column-title {
            color: #fff;
        }
        .plan-column[data-experiment-id="univa"] .plan-column-model {
            color: rgba(255,255,255,0.7);
        }

        .plan-column-title-group {
            display: flex;
            flex-direction: column;
            gap: 0.1rem;
        }

        .plan-column-title {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--color-text-secondary);
        }

        .plan-column-model {
            font-size: 0.7rem;
            color: var(--color-text-muted);
        }

        .plan-view-toggle {
            display: flex;
            gap: 0;
            border: 1px solid var(--color-border);
            border-radius: 4px;
            overflow: hidden;
        }

        .plan-column[data-experiment-id] .plan-view-toggle {
            border-color: rgba(255,255,255,0.4);
        }

        .plan-view-btn {
            padding: 0.15rem 0.4rem;
            font-size: 0.65rem;
            border: none;
            background: var(--color-bg);
            color: var(--color-text-muted);
            cursor: pointer;
            transition: all 0.2s;
        }

        .plan-view-btn.active {
            background: var(--color-accent);
            color: white;
        }

        .plan-column-body {
            padding: 0.75rem;
            max-height: 500px;
            overflow-y: auto;
            font-size: 0.8rem;
        }

        .plan-column-body.placeholder {
            color: var(--color-text-muted);
            font-style: italic;
            padding: 1rem;
        }

        /* 任务分析 */
        .plan-task-analysis {
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--color-border);
            font-size: 0.8rem;
            color: var(--color-text-secondary);
            line-height: 1.5;
        }

        .plan-task-analysis-label {
            font-weight: 600;
            color: var(--color-text);
            margin-bottom: 0.25rem;
            display: block;
            font-size: 0.75rem;
        }

        /* Step 卡片 */
        .plan-steps-header {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--color-text);
            margin-bottom: 0.5rem;
        }

        .plan-step-card {
            margin-bottom: 0.5rem;
            background: var(--color-bg-alt);
            border-radius: 4px;
            border-left: 3px solid var(--color-accent);
            overflow: hidden;
        }

        .plan-step-card-header {
            padding: 0.4rem 0.5rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        .plan-step-card-header:hover {
            background: rgba(37, 99, 235, 0.04);
        }

        .plan-step-card-title {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            margin-bottom: 0.2rem;
        }

        .plan-step-num {
            background: var(--color-accent);
            color: white;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 600;
            flex-shrink: 0;
        }

        .plan-step-tool-name {
            font-family: var(--font-mono);
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--color-accent);
        }

        .plan-step-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.2rem;
            margin-left: 26px;
            margin-bottom: 0.2rem;
        }

        .plan-step-desc-text {
            margin-left: 26px;
            font-size: 0.75rem;
            color: var(--color-text-secondary);
        }

        .plan-step-toggle {
            margin-left: 26px;
            font-size: 0.7rem;
            color: var(--color-accent);
            display: inline-flex;
            align-items: center;
            gap: 0.2rem;
        }

        .plan-step-card-details {
            display: none;
            margin: 0 0.5rem 0.5rem;
            padding: 0.4rem 0.5rem;
            margin-left: 26px;
            background: var(--color-bg);
            border-radius: 4px;
            border: 1px dashed var(--color-border);
            font-size: 0.7rem;
        }

        .plan-step-card-details.expanded {
            display: block;
        }

        .plan-step-detail-row {
            display: flex;
            margin-bottom: 0.2rem;
        }

        .plan-step-detail-row:last-child {
            margin-bottom: 0;
        }

        .plan-step-detail-label {
            color: var(--color-text-muted);
            min-width: 60px;
            flex-shrink: 0;
            font-weight: 500;
        }

        .plan-step-detail-value {
            color: var(--color-text-secondary);
            word-break: break-word;
        }

        .plan-step-dep-label {
            margin-left: 26px;
            font-size: 0.65rem;
            color: var(--color-text-muted);
        }

        /* 工具链 */
        .plan-tool-chain-summary {
            margin-top: 0.75rem;
            padding-top: 0.5rem;
            border-top: 1px solid var(--color-border);
            font-size: 0.7rem;
            color: var(--color-text-muted);
        }

        .plan-tool-chain-summary .label {
            font-weight: 500;
            margin-right: 0.25rem;
        }

        /* renderjson 覆盖样式 */
        .plan-json-view {
            display: none;
        }

        .plan-json-view.active {
            display: block;
        }

        .plan-structured-view.hidden {
            display: none;
        }

        .plan-json-view .renderjson {
            font-family: var(--font-mono);
            font-size: 0.72rem;
            line-height: 1.5;
        }

        .plan-json-view .renderjson a {
            text-decoration: none;
            color: var(--color-accent);
        }

        /* ========== JSON 工具栏（通用） ========== */
        .json-toolbar {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.3rem 0.6rem;
            background: var(--color-bg-alt);
            border-bottom: 1px solid var(--color-border);
            font-size: 0.7rem;
        }

        .json-toolbar button {
            padding: 0.15rem 0.4rem;
            border: 1px solid var(--color-border);
            border-radius: 3px;
            background: var(--color-bg);
            color: var(--color-text-secondary);
            cursor: pointer;
            font-size: 0.65rem;
            transition: all 0.2s;
        }

        .json-toolbar button:hover {
            background: var(--color-accent-light);
            border-color: var(--color-accent);
            color: var(--color-accent);
        }

        .json-toolbar button.active {
            background: var(--color-accent);
            color: white;
            border-color: var(--color-accent);
        }

        .json-toolbar input[type="range"] {
            width: 80px;
            height: 4px;
            cursor: pointer;
            accent-color: var(--color-accent);
        }

        .json-toolbar .level-label {
            color: var(--color-text-muted);
            font-family: var(--font-mono);
            min-width: 28px;
        }

        .json-content {
            padding: 0.5rem;
        }

        /* JSON 换行模式 */
        .json-wrap .renderjson,
        .json-wrap .json-content {
            white-space: pre-wrap;
            word-break: break-word;
        }

        /* ========== 提示词模板 JSON 块 ========== */
        .prompt-json-block {
            border: 1px solid var(--color-border);
            border-radius: 6px;
            margin: 0.75rem 0;
            overflow: hidden;
        }

        .prompt-json-block .json-content {
            max-height: 400px;
            overflow-y: auto;
        }

        .prompt-json-block .renderjson {
            font-family: var(--font-mono);
            font-size: 0.72rem;
            line-height: 1.5;
        }

        .prompt-json-block .renderjson a {
            text-decoration: none;
            color: var(--color-accent);
        }

        /* ========== 实验面板说明文字 ========== */
        .experiment-panels-desc {
            font-size: 0.85rem;
            color: var(--color-text-secondary);
            margin-bottom: 0.75rem;
            line-height: 1.6;
        }

        /* ========== 返回 Case 浮动按钮 ========== */
        .return-to-case-btn {
            display: none;
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 200;
            background: rgba(37, 99, 235, 0.85);
            color: white;
            border-radius: 8px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
            font-size: 0.85rem;
            overflow: hidden;
            cursor: default;
        }

        .return-to-case-btn.visible {
            display: flex;
            align-items: center;
        }

        .return-text {
            padding: 0.5rem 0.75rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        .return-text:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .return-close {
            padding: 0.5rem 0.6rem;
            cursor: pointer;
            border-left: 1px solid rgba(255, 255, 255, 0.3);
            transition: background 0.2s;
            font-size: 1rem;
            line-height: 1;
        }

        .return-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* ========== Case 复制链接按钮 ========== */
        .case-copy-link {
            color: var(--color-accent);
            text-decoration: none;
            font-size: 0.9rem;
            cursor: pointer;
            transition: transform 0.2s;
            user-select: none;
        }

        .case-copy-link:hover {
            transform: scale(1.1);
        }

        /* Case 高亮效果（URL 定位时） */
        .case-card.hash-highlight {
            outline: 2px solid var(--color-accent);
            outline-offset: 2px;
        }

        /* ========== 响应式 ========== */
        @media (max-width: 1200px) {
            .paper-info-grid {
                grid-template-columns: 1fr 1fr;
            }

            .paper-info-cell:nth-child(5) {
                grid-column: span 1;
            }

            .paper-info-cell:nth-child(6) {
                grid-column: span 1;
            }
        }

        @media (max-width: 900px) {
            .ability-overview-table {
                grid-template-columns: repeat(3, 1fr);
            }

            .ability-column:nth-child(4),
            .ability-column:nth-child(5) {
                grid-column: auto;
            }

            .case-info-grid {
                grid-template-columns: 1fr;
            }

            .case-question-cell {
                grid-row: auto;
            }

            .reasoning-grid {
                grid-template-columns: 1fr;
            }

            .case-plan-comparison {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 2rem 1rem;
            }

            .main {
                padding: 1.5rem 1rem;
            }

            .ability-overview-table {
                grid-template-columns: 1fr;
            }

            .filter-buttons {
                flex-direction: column;
            }

            .filter-btn {
                width: 100%;
                justify-content: flex-start;
            }

            .paper-info-grid {
                grid-template-columns: 1fr;
            }

            .tool-card,
            .memory-card {
                width: 100%;
            }
        }

        /* 滚动条样式 */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: var(--color-bg-alt);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--color-border);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--color-text-muted);
        }

        /* Loading 状态 */
        .loading {
            text-align: center;
            padding: 3rem;
            color: var(--color-text-muted);
        }

        .loading::after {
            content: "";
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--color-border);
            border-top-color: var(--color-accent);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-left: 0.5rem;
            vertical-align: middle;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Side Navigation - Left Sidebar */
        .side-nav {
            position: fixed;
            top: 50%;
            left: 0;
            transform: translateY(-50%) translateX(calc(-100% + 20px));
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid var(--color-border);
            border-left: none;
            border-radius: 0 0.5rem 0.5rem 0;
            z-index: 100;
            padding: 0.75rem 0;
            box-shadow: 2px 0 20px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease;
        }

        .side-nav:hover {
            transform: translateY(-50%) translateX(0);
        }

        /* 边缘提示箭头 */
        .side-nav::after {
            content: "›";
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 14px;
            color: var(--color-text-muted);
            opacity: 1;
            transition: opacity 0.3s;
        }

        .side-nav:hover::after {
            opacity: 0;
        }

        .side-nav-inner {
            display: flex;
            flex-direction: column;
            gap: 0;
        }

        .side-nav-item {
            display: block;
            padding: 0.5rem 1rem;
            padding-right: 1.5rem;
            font-size: 0.8rem;
            font-weight: 500;
            color: var(--color-text-secondary);
            text-decoration: none;
            white-space: nowrap;
            border-left: 3px solid transparent;
            transition: all 0.2s;
        }

        .side-nav-item:hover,
        .side-nav-item.active {
            color: var(--color-accent);
            border-left-color: var(--color-accent);
            background: var(--color-accent-light);
            text-decoration: none;
        }

        @media (max-width: 1100px) {
            .side-nav {
                display: none;
            }
        }
    </style>
</head>

<body>
    <!-- Image Modal -->
    <div class="image-modal" id="imageModal">
        <div class="image-modal-overlay" onclick="closeImageModal()"></div>
        <div class="image-modal-content">
            <img id="modalImage" src="" alt="方法图">
            <button class="image-modal-close" onclick="closeImageModal()">×</button>
        </div>
    </div>

    <!-- Side Navigation -->
    <nav class="side-nav" id="side-nav">
        <div class="side-nav-inner">
            <a href="#ability-overview" class="side-nav-item active" data-section="ability-overview">〇、能力概览</a>
            <a href="#ability-filter" class="side-nav-item" data-section="ability-filter">一、筛选</a>
            <a href="#papers-section" class="side-nav-item" data-section="papers-section">二、论文</a>
            <a href="#cases-section" class="side-nav-item" data-section="cases-section">三、Case</a>
        </div>
    </nav>
    <!-- Header -->
    <header class="header">
        <span class="header-tag">可视化分析</span>
        <h1>长视频理解能力分析</h1>
        <p class="subtitle">Long Video Understanding - Ability Analysis & Visualization</p>
    </header>

    <!-- Main Content -->
    <main class="main">
        <!-- 一、能力分类概览 -->
        <section class="section" id="ability-overview">
            <div class="section-header">
                <span class="section-number">01</span>
                <h2 class="section-title">能力分类概览</h2>
            </div>

            <div class="ability-overview-table">
                <!-- 视觉感知 -->
                <div class="ability-column" data-ability="visual_perception">
                    <div class="ability-header">
                        <div class="ability-icon">🟢</div>
                        <div class="ability-name-zh">视觉感知</div>
                        <div class="ability-name-en">Visual Perception</div>
                    </div>
                    <div class="ability-skills">
                        <ul>
                            <li>物体识别 (Object Recognition)</li>
                            <li>动作识别 (Action Recognition)</li>
                            <li>文字识别 (OCR)</li>
                            <li>属性识别 (Attribute Recognition)</li>
                            <li>颜色识别 (Color Recognition)</li>
                            <li>文本识别 (Text Recognition)</li>
                        </ul>
                    </div>
                    <div class="ability-examples">
                        <p><span class="icon">📝</span>图中有哪些物体？</p>
                        <p><span class="icon">📝</span>有多少个红色的方块？</p>
                    </div>
                </div>

                <!-- 时间动态理解 -->
                <div class="ability-column" data-ability="temporal_dynamics">
                    <div class="ability-header">
                        <div class="ability-icon">🔵</div>
                        <div class="ability-name-zh">时间动态理解</div>
                        <div class="ability-name-en">Temporal Dynamics</div>
                    </div>
                    <div class="ability-skills">
                        <ul>
                            <li>时间定位 (Temporal Grounding)</li>
                            <li>时间排序 (Temporal Ordering)</li>
                            <li>动作计数 (Action Counting)</li>
                            <li>事件计数 (Event Counting)</li>
                        </ul>
                    </div>
                    <div class="ability-examples">
                        <p><span class="icon">📝</span>该动作发生在视频的哪一段？</p>
                        <p><span class="icon">📝</span>哪个事件先发生？</p>
                    </div>
                </div>

                <!-- 高层推理 -->
                <div class="ability-column" data-ability="high_level_reasoning">
                    <div class="ability-header">
                        <div class="ability-icon">🔴</div>
                        <div class="ability-name-zh">高层推理</div>
                        <div class="ability-name-en">High-Level Reasoning</div>
                    </div>
                    <div class="ability-skills">
                        <ul>
                            <li>算术推理 (Arithmetic Reasoning)</li>
                            <li>计数 (Counting)</li>
                            <li>数学推理 (Mathematical Reasoning)</li>
                            <li>事件计数 (Event Counting)</li>
                            <li>动作计数 (Action Counting)</li>
                            <li>顺序理解 (Sequential Understanding)</li>
                        </ul>
                    </div>
                    <div class="ability-examples">
                        <p><span class="icon">📝</span>如果每组有3个物体，共5组...</p>
                        <p><span class="icon">📝</span>哪一类数量更多？</p>
                    </div>
                </div>

                <!-- 空间与物体动态 -->
                <div class="ability-column" data-ability="spatial_object_dynamics">
                    <div class="ability-header">
                        <div class="ability-icon">🟠</div>
                        <div class="ability-name-zh">空间与物体动态</div>
                        <div class="ability-name-en">Spatial & Object Dynamics</div>
                    </div>
                    <div class="ability-skills">
                        <ul>
                            <li>空间定位 (Spatial Localization)</li>
                            <li>空间关系识别 (Spatial Relation Recognition)</li>
                            <li>物体计数 (Object Counting)</li>
                            <li>空间关系感知 (Spatial Relation Perception)</li>
                            <li>空间推理 (Spatial Reasoning)</li>
                            <li>物体跟踪 (Object Tracking)</li>
                        </ul>
                    </div>
                    <div class="ability-examples">
                        <p><span class="icon">📝</span>物体A位于物体B的哪个方向？</p>
                        <p><span class="icon">📝</span>哪个物体最靠近中心？</p>
                    </div>
                </div>

                <!-- 视听联合理解 -->
                <div class="ability-column" data-ability="audiovisual_joint">
                    <div class="ability-header">
                        <div class="ability-icon">🟣</div>
                        <div class="ability-name-zh">视听联合理解</div>
                        <div class="ability-name-en">Audio-Visual Understanding</div>
                    </div>
                    <div class="ability-skills">
                        <ul>
                            <li>语音识别 (Speech Recognition)</li>
                            <li>视听对齐 (Audio-Visual Alignment)</li>
                            <li>音频事件检测 (Audio Event Detection)</li>
                            <li>视听关联 (Audio-Visual Association)</li>
                        </ul>
                    </div>
                    <div class="ability-examples">
                        <p><span class="icon">📝</span>这段语音对应画面中的谁？</p>
                        <p><span class="icon">📝</span>声音是否与画面同步？</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 二、能力筛选器 -->
        <section class="filter-section" id="ability-filter">
            <div class="filter-header">
                <span class="filter-title">能力筛选 (多选，AND 逻辑)</span>
                <a href="#" class="filter-clear" onclick="clearFilters(); return false;">清除全部</a>
            </div>
            <div class="filter-buttons">
                <button class="filter-btn" data-ability="visual_perception" onclick="toggleFilter(this)">
                    <span class="checkbox"></span>
                    <span>视觉感知</span>
                </button>
                <button class="filter-btn" data-ability="temporal_dynamics" onclick="toggleFilter(this)">
                    <span class="checkbox"></span>
                    <span>时间动态理解</span>
                </button>
                <button class="filter-btn" data-ability="high_level_reasoning" onclick="toggleFilter(this)">
                    <span class="checkbox"></span>
                    <span>高层推理</span>
                </button>
                <button class="filter-btn" data-ability="spatial_object_dynamics" onclick="toggleFilter(this)">
                    <span class="checkbox"></span>
                    <span>空间与物体动态</span>
                </button>
                <button class="filter-btn" data-ability="audiovisual_joint" onclick="toggleFilter(this)">
                    <span class="checkbox"></span>
                    <span>视听联合理解</span>
                </button>
            </div>
            <div class="filter-status">
                <span class="filter-current">当前筛选: <span id="filter-current-text">无 (显示全部)</span></span>
                <div class="filter-status-counts">
                    <span>匹配论文: <span id="paper-count">0</span></span>
                    <span>匹配Case: <span id="case-count">0</span></span>
                </div>
            </div>
        </section>

        <!-- 三、论文方法展示区 -->
        <section class="section" id="papers-section">
            <div class="section-header">
                <span class="section-number">02</span>
                <h2 class="section-title">论文方法展示</h2>
                <span class="section-count" id="papers-total-count"></span>
            </div>
            <div id="papers-container">
                <div class="loading">加载数据中</div>
            </div>
        </section>

        <!-- 四、Case 展示区 -->
        <section class="section" id="cases-section">
            <div class="section-header">
                <span class="section-number">03</span>
                <h2 class="section-title">Case 展示</h2>
                <span class="section-count" id="cases-total-count"></span>
                <span class="case-copy-link" title="复制此区域的分享链接" onclick="copySectionLink('cases', this)" style="margin-left: 0.5rem;">🔗 复制链接</span>
            </div>
            <div id="experiment-panels" class="experiment-panels">
                <!-- 实验模板面板由 JS 渲染 -->
            </div>
            <div id="cases-container">
                <div class="loading">加载数据中</div>
            </div>
        </section>
    </main>

    <!-- Return to Case Button -->
    <div class="return-to-case-btn" id="returnToCaseBtn">
        <span class="return-text" id="returnText" onclick="returnToCase()"></span>
        <span class="return-close" onclick="hideReturnButton()">×</span>
    </div>

    <script>
        // ==================== 全局数据 ====================
        let data = null;
        let toolsData = null;       // long_video_understanding_tools.json
        let experiments = [];       // experiment_index 中的实验列表
        let experimentResults = {}; // experiment_id -> {meta, results: Map<case_id, plan>}
        let experimentPrompts = {}; // experiment_id -> system_prompt 文本
        let toolLookup = new Map(); // 工具名 -> {sources, layer}
        let selectedAbilities = new Set();
        let returnCaseId = null;     // 标签跳转前的 case id

        // UniVA 工具名映射: plan 中工具名 -> data.json 中 UniVA tool name
        const UNIVA_TOOL_MAP = {
            'vision2text_gen': 'Video Understanding-vision2text_gen',
            'video_timestamp_analysis': 'Video Understanding-video_timestamp_analysis',
            'main_object_analysis': 'Video Understanding-main_object_analysis',
            'video_referring_segmentation': 'Video Tracking-video_referring_segmentation'
        };

        const abilityNames = {
            'visual_perception': '视觉感知',
            'temporal_dynamics': '时间动态理解',
            'high_level_reasoning': '高层推理',
            'spatial_object_dynamics': '空间与物体动态',
            'audiovisual_joint': '视听联合理解'
        };
        const abilityFullNames = abilityNames;

        // 提取工具名的二级名称
        function getToolShortName(fullName) {
            if (!fullName) return '';
            return fullName.includes('-') ? fullName.split('-').slice(1).join('-').trim() : fullName;
        }

        // 构建工具查找表
        function buildToolLookup() {
            toolLookup = new Map();
            // 1. 从 long_video_understanding_tools.json
            if (toolsData && toolsData.tools) {
                for (const tool of toolsData.tools) {
                    const sources = (tool.sources || []).map(s => {
                        const paper = data.papers.find(p => p.name === s.paper);
                        const paperTool = paper?.tools?.find(t => t.name === s.tool);
                        return {
                            paper: s.paper,
                            paperId: paper?.id || '',
                            originalTool: s.tool,
                            shortName: getToolShortName(s.tool),
                            abilities: paperTool?.abilities || []
                        };
                    });
                    toolLookup.set(tool.name, { sources, layer: tool.layer });
                }
            }
            // 2. UniVA 手动映射
            const univaPaper = data.papers.find(p => p.id === 'univa');
            if (univaPaper) {
                for (const [planName, dataName] of Object.entries(UNIVA_TOOL_MAP)) {
                    if (!toolLookup.has(planName)) {
                        const paperTool = univaPaper.tools?.find(t => t.name === dataName);
                        toolLookup.set(planName, {
                            sources: [{
                                paper: 'UniVA',
                                paperId: 'univa',
                                originalTool: dataName,
                                shortName: getToolShortName(dataName),
                                abilities: paperTool?.abilities || []
                            }],
                            layer: null
                        });
                    }
                }
            }
        }

        // 生成工具标签 HTML（caseId 可选，用于返回按钮）
        function renderToolTags(toolName, caseId) {
            const info = toolLookup.get(toolName);
            if (!info) return '';
            let html = '';
            const allAbilities = new Set();
            const caseArg = caseId ? `, '${caseId}'` : '';
            for (const src of info.sources) {
                const toolId = `tool-${src.paperId}-${src.originalTool.replace(/[^a-zA-Z0-9\u4e00-\u9fff]/g, '-').toLowerCase()}`;
                html += `<span class="source-tag" onclick="scrollToToolCard('${toolId}'${caseArg})" title="${src.paper}: ${src.originalTool}">${src.paper}: ${src.shortName}</span>`;
                src.abilities.forEach(a => allAbilities.add(a));
            }
            for (const a of allAbilities) {
                html += `<span class="plan-ability-tag" data-ability="${a}" onclick="filterByAbility('${a}'${caseArg})">${abilityNames[a] || a}</span>`;
            }
            return html;
        }

        // 滚动到论文 tool 卡片
        function scrollToToolCard(toolId, fromCaseId) {
            const el = document.getElementById(toolId);
            if (el) {
                el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                el.style.outline = '2px solid var(--color-accent)';
                setTimeout(() => { el.style.outline = ''; }, 2000);
            }
            if (fromCaseId) showReturnButton(fromCaseId);
        }

        // 返回 Case 浮动按钮
        function showReturnButton(caseId) {
            returnCaseId = caseId;
            const btn = document.getElementById('returnToCaseBtn');
            document.getElementById('returnText').textContent = `↩ 返回 ${caseId}`;
            btn.classList.add('visible');
        }

        function hideReturnButton() {
            document.getElementById('returnToCaseBtn').classList.remove('visible');
            returnCaseId = null;
        }

        function returnToCase() {
            if (returnCaseId) {
                const el = document.getElementById('case-' + returnCaseId);
                if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
            hideReturnButton();
        }

        // ==================== JSON 视图通用工具 ====================
        // 存储每个 JSON 视图的数据和状态
        const jsonViewRegistry = {};

        function createJsonToolbar(containerId, defaultLevel) {
            const toolbar = document.createElement('div');
            toolbar.className = 'json-toolbar';
            toolbar.innerHTML = `
                <button onclick="jsonSetLevel('${containerId}', 0)">全部收起</button>
                <button onclick="jsonSetLevel('${containerId}', 'all')">全部展开</button>
                <input type="range" min="0" max="6" value="${defaultLevel === 'all' ? 6 : defaultLevel}" oninput="jsonSliderChange('${containerId}', this.value)">
                <span class="level-label">Lv.${defaultLevel === 'all' ? 6 : defaultLevel}</span>
                <button onclick="jsonToggleWrap('${containerId}', this)">换行</button>
            `;
            return toolbar;
        }

        function renderJsonContent(containerId, jsonData, level) {
            const reg = jsonViewRegistry[containerId];
            if (!reg) return;
            const contentEl = reg.contentEl;
            contentEl.innerHTML = '';
            const showLevel = level === 'all' ? 'all' : parseInt(level);
            renderjson.set_show_to_level(showLevel);
            renderjson.set_icons('+', '-');
            contentEl.appendChild(renderjson(jsonData));
            renderjson.set_show_to_level(2); // 恢复默认
        }

        function jsonSetLevel(containerId, level) {
            const reg = jsonViewRegistry[containerId];
            if (!reg) return;
            renderJsonContent(containerId, reg.data, level);
            // 更新滑块和标签
            const toolbar = reg.toolbarEl;
            const slider = toolbar.querySelector('input[type="range"]');
            const label = toolbar.querySelector('.level-label');
            if (level === 'all') {
                slider.value = 6;
                label.textContent = 'Lv.6';
            } else {
                slider.value = level;
                label.textContent = `Lv.${level}`;
            }
        }

        function jsonSliderChange(containerId, value) {
            const reg = jsonViewRegistry[containerId];
            if (!reg) return;
            const intVal = parseInt(value);
            const level = intVal >= 6 ? 'all' : intVal;
            renderJsonContent(containerId, reg.data, level);
            const label = reg.toolbarEl.querySelector('.level-label');
            label.textContent = `Lv.${value}`;
        }

        function jsonToggleWrap(containerId, btn) {
            const reg = jsonViewRegistry[containerId];
            if (!reg) return;
            const container = reg.containerEl;
            container.classList.toggle('json-wrap');
            btn.classList.toggle('active');
        }

        function initJsonView(containerId, containerEl, jsonData, defaultLevel) {
            const toolbar = createJsonToolbar(containerId, defaultLevel);
            const content = document.createElement('div');
            content.className = 'json-content';
            containerEl.appendChild(toolbar);
            containerEl.appendChild(content);
            jsonViewRegistry[containerId] = {
                containerEl: containerEl,
                toolbarEl: toolbar,
                contentEl: content,
                data: jsonData
            };
            renderJsonContent(containerId, jsonData, defaultLevel);
        }

        // ==================== 初始化 ====================
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const [dataResp, toolsResp, expIndexResp] = await Promise.all([
                    fetch('data/data.json'),
                    fetch('data/long_video_understanding_tools.json'),
                    fetch('data/experiment_index.json')
                ]);
                data = await dataResp.json();
                toolsData = await toolsResp.json();
                const expIndex = await expIndexResp.json();
                experiments = expIndex.experiments || [];

                // 加载各实验的结果和提示词
                const loadPromises = experiments.flatMap(exp => [
                    fetch(`data/${exp.data_file}`).then(r => r.json()).then(d => {
                        const resultsMap = new Map();
                        (d.results || []).forEach(r => resultsMap.set(r.case_id, r.plan));
                        experimentResults[exp.id] = { meta: d.meta, results: resultsMap };
                    }),
                    fetch(`data/${exp.prompts.system}`).then(r => r.text()).then(t => {
                        experimentPrompts[exp.id] = t;
                    }).catch(() => { experimentPrompts[exp.id] = ''; })
                ]);
                await Promise.all(loadPromises);

                buildToolLookup();
                renderPapers();
                renderExperimentPanels();
                renderCases();
                updateCounts();
                handleUrlHash();
            } catch (error) {
                console.error('加载数据失败:', error);
                document.getElementById('papers-container').innerHTML = '<p style="color: red;">加载数据失败，请刷新页面重试</p>';
                document.getElementById('cases-container').innerHTML = '<p style="color: red;">加载数据失败，请刷新页面重试</p>';
            }
        });

        // ==================== 论文渲染 ====================
        function renderPapers() {
            const container = document.getElementById('papers-container');
            container.innerHTML = '';
            data.papers.forEach(paper => {
                container.appendChild(createPaperCard(paper));
            });
            document.getElementById('papers-total-count').textContent = `共 ${data.papers.length} 篇论文`;
        }

        function createPaperCard(paper) {
            const card = document.createElement('div');
            card.className = 'paper-card';
            card.dataset.paperId = paper.id;
            const allAbilities = new Set();
            paper.tools?.forEach(tool => tool.abilities?.forEach(a => allAbilities.add(a)));
            paper.memory?.abilities?.forEach(a => allAbilities.add(a));
            card.dataset.abilities = JSON.stringify([...allAbilities]);

            card.innerHTML = `
                <div class="paper-header">
                    <span class="paper-icon">📄</span>
                    <span class="paper-name">${paper.name}</span>
                    ${paper.fullName ? `<a href="${paper.paperUrl || '#'}" target="_blank" class="paper-full-name" title="查看论文">${paper.fullName}</a>` : ''}
                </div>
                <div class="paper-info-grid">
                    <div class="paper-info-cell">
                        <div class="paper-info-label">问题</div>
                        <div class="paper-info-value">${paper.problem || '-'}</div>
                    </div>
                    <div class="paper-info-cell">
                        <div class="paper-info-label">主要方法</div>
                        <div class="paper-info-value"><ul>${(paper.methods || []).map(m => `<li>${m}</li>`).join('')}</ul></div>
                    </div>
                    <div class="paper-info-cell">
                        <div class="paper-info-label">基座模型</div>
                        <div class="paper-info-value">${paper.baseModel || '-'}</div>
                    </div>
                    <div class="paper-info-cell">
                        <div class="paper-info-label">训练方式</div>
                        <div class="paper-info-value">${paper.trainingMethod || '-'}</div>
                    </div>
                    <div class="paper-info-cell">
                        <div class="paper-info-label">关键发现 / 未解决问题</div>
                        <div class="paper-info-value">
                            ${paper.keyFindings ? `<strong>发现:</strong> ${paper.keyFindings}<br>` : ''}
                            ${paper.unsolvedProblems ? `<strong>未解决:</strong> ${paper.unsolvedProblems}` : ''}
                        </div>
                    </div>
                    <div class="paper-info-cell">
                        <div class="paper-info-label">方法图</div>
                        <div class="paper-info-value">
                            ${paper.overviewImage
                                ? `<img class="paper-thumbnail" src="images/overview/${paper.overviewImage.split('/').pop()}" alt="${paper.name} 方法图" onclick="openImageModal(this.src)">`
                                : '<span class="no-image">暂无图片</span>'}
                        </div>
                    </div>
                </div>
                <div class="tools-memory-section">
                    <div class="tools-memory-header">Tools & Memory</div>
                    <div class="tools-memory-grid" data-paper-id="${paper.id}">
                        ${renderToolCards(paper.tools || [], paper.id)}
                        ${paper.memory ? renderMemoryCard(paper.memory) : ''}
                    </div>
                </div>
            `;
            return card;
        }

        function renderToolCards(tools, paperId) {
            return tools.map(tool => {
                const toolId = `tool-${paperId}-${tool.name.replace(/[^a-zA-Z0-9\u4e00-\u9fff]/g, '-').toLowerCase()}`;
                return `
                <div class="tool-card" id="${toolId}" data-abilities='${JSON.stringify(tool.abilities || [])}'>
                    <div class="tool-card-header">
                        <span>🔧</span>
                        <span>${tool.name}</span>
                    </div>
                    <div class="tool-card-body">
                        <div class="tool-card-row"><span class="tool-card-label">实现:</span><span class="tool-card-value">${tool.implementation || '-'}</span></div>
                        <div class="tool-card-row"><span class="tool-card-label">输入:</span><span class="tool-card-value">${tool.input || '-'}</span></div>
                        <div class="tool-card-row"><span class="tool-card-label">输出:</span><span class="tool-card-value">${tool.output || '-'}</span></div>
                        <div class="tool-card-row"><span class="tool-card-label">用途:</span><span class="tool-card-value">${tool.purpose || '-'}</span></div>
                    </div>
                    <div class="tool-card-abilities">
                        ${(tool.abilities || []).map(a => `<span class="ability-tag" data-ability="${a}" onclick="filterByAbility('${a}')">${abilityNames[a] || a}</span>`).join('')}
                    </div>
                </div>`;
            }).join('');
        }

        function renderMemoryCard(memory) {
            return `
                <div class="memory-card" data-abilities='${JSON.stringify(memory.abilities || [])}'>
                    <div class="memory-card-header"><span>📦</span><span>Memory</span></div>
                    <div class="memory-card-body">
                        <div class="memory-card-row"><span class="memory-card-label">处理:</span><span class="memory-card-value">${memory.contextHandling || '-'}</span></div>
                        <div class="memory-card-row"><span class="memory-card-label">机制:</span><span class="memory-card-value">${memory.mechanism || '-'}</span></div>
                        <div class="memory-card-row"><span class="memory-card-label">设计:</span><span class="memory-card-value">${memory.keyDesign || '-'}</span></div>
                    </div>
                    <div class="memory-card-abilities">
                        ${(memory.abilities || []).map(a => `<span class="ability-tag" data-ability="${a}" onclick="filterByAbility('${a}')">${abilityNames[a] || a}</span>`).join('')}
                    </div>
                </div>`;
        }

        // ==================== 实验模板面板 ====================
        function renderExperimentPanels() {
            const container = document.getElementById('experiment-panels');
            container.innerHTML = '';
            // 说明文字
            const desc = document.createElement('p');
            desc.className = 'experiment-panels-desc';
            desc.innerHTML = '以下为两组实验<strong>生成 Plan 轨迹</strong>所用的 <strong>System Prompt</strong>，定义了各自可选的工具集。其中「分层 21 工具集」的工具定义聚合自上方「02 论文方法展示」中各论文提出的工具，每个工具均标注了来源论文与对应能力。两组实验的 User Prompt 相同，均为：<code>Analyze the video at ./video.mp4 and answer the question: {question}</code>';
            container.appendChild(desc);
            const sortedExps = [...experiments].sort((a, b) => a.id === 'exp_001_baseline' ? -1 : b.id === 'exp_001_baseline' ? 1 : 0);
            sortedExps.forEach(exp => {
                const panel = document.createElement('div');
                panel.className = 'experiment-panel';
                panel.dataset.experimentId = exp.id;
                const promptText = experimentPrompts[exp.id] || '';
                panel.innerHTML = `
                    <div class="experiment-panel-header" onclick="toggleExperimentPanel(this)">
                        <span>${exp.name}</span>
                        <span class="experiment-panel-toggle">展开 ▼</span>
                    </div>
                    <div class="experiment-panel-body" id="exp-panel-${exp.id}"></div>
                `;
                container.appendChild(panel);
                // 渲染 markdown + 工具标注
                renderPromptTemplate(exp.id, promptText);
            });
        }

        function toggleExperimentPanel(header) {
            const body = header.nextElementSibling;
            const toggle = header.querySelector('.experiment-panel-toggle');
            if (body.classList.contains('expanded')) {
                body.classList.remove('expanded');
                toggle.textContent = '展开 ▼';
            } else {
                body.classList.add('expanded');
                toggle.textContent = '收起 ▲';
            }
        }

        function renderPromptTemplate(expId, promptText) {
            const container = document.getElementById(`exp-panel-${expId}`);
            if (!promptText) { container.innerHTML = '<em>暂无模板内容</em>'; return; }
            // marked.js 渲染
            container.innerHTML = marked.parse(promptText);
            // DOM 后处理 1：找所有 <strong>tool_name</strong> 并注入标签
            const strongElements = container.querySelectorAll('strong');
            strongElements.forEach(el => {
                const toolName = el.textContent.trim();
                const info = toolLookup.get(toolName);
                if (!info) return;
                const parent = el.closest('li') || el.closest('p') || el.parentElement;
                if (!parent) return;
                const tagLine = document.createElement('div');
                tagLine.className = 'tool-annotation-line';
                tagLine.innerHTML = renderToolTags(toolName);
                parent.insertBefore(tagLine, parent.firstChild);
            });
            // DOM 后处理 2：提取 Example format JSON 并用 renderjson 渲染
            extractAndRenderExampleJson(container, expId);
        }

        function extractAndRenderExampleJson(container, expId) {
            // 找到包含 "Example format:" 的元素
            let exampleEl = null;
            const allElements = container.querySelectorAll('p, h2, h3, h4');
            for (const el of allElements) {
                if (el.textContent.trim().startsWith('Example format')) {
                    exampleEl = el;
                    break;
                }
            }
            if (!exampleEl) return;

            // 收集 exampleEl 之后到 "Planning Updates" h2 之间的所有元素
            const toRemove = [];
            let jsonText = '';
            let sibling = exampleEl.nextElementSibling;
            while (sibling) {
                if (sibling.tagName === 'H2' && sibling.textContent.includes('Planning Updates')) break;
                jsonText += sibling.textContent + '\n';
                toRemove.push(sibling);
                sibling = sibling.nextElementSibling;
            }

            // 清理并解析 JSON
            jsonText = jsonText.trim();
            if (!jsonText) return;

            let parsed = null;
            try {
                parsed = JSON.parse(jsonText);
            } catch (e) {
                // UniVA JSON 有 trailing commas，容错处理
                try {
                    parsed = JSON.parse(jsonText.replace(/,\s*}/g, '}').replace(/,\s*]/g, ']'));
                } catch (e2) {
                    console.warn('无法解析 Example format JSON:', e2);
                    return;
                }
            }

            // 移除原始文本节点
            toRemove.forEach(el => el.remove());

            // 插入 renderjson 视图
            const block = document.createElement('div');
            block.className = 'prompt-json-block';
            exampleEl.after(block);

            const viewId = `prompt-json-${expId}`;
            initJsonView(viewId, block, parsed, 'all');
        }

        // ==================== Case 渲染 ====================
        function renderCases() {
            const container = document.getElementById('cases-container');
            container.innerHTML = '';
            data.cases.forEach(caseItem => {
                container.appendChild(createCaseCard(caseItem));
            });
            document.getElementById('cases-total-count').textContent = `共 ${data.cases.length} 个 Case`;
        }

        function createCaseCard(caseItem) {
            const card = document.createElement('div');
            card.className = 'case-card';
            card.id = `case-${caseItem.id}`;
            card.dataset.caseId = caseItem.id;
            card.dataset.abilities = JSON.stringify(caseItem.abilities || []);

            const options = caseItem.options || [];
            const answer = caseItem.answer || '';

            card.innerHTML = `
                <div class="case-header">
                    <div class="case-header-left">
                        <span class="case-icon">🎬</span>
                        <span class="case-id">${caseItem.id}</span>
                    </div>
                    <div class="case-header-right">
                        <span class="case-copy-link" title="复制此 Case 的分享链接" onclick="copyCaseLink('${caseItem.id}', this)">🔗 复制链接</span>
                        ${caseItem.youtubeLink ? `<a href="${caseItem.youtubeLink}" target="_blank" class="case-link" title="观看视频">▶️</a>` : ''}
                    </div>
                </div>
                <div class="case-body">
                    <div class="case-info-section">
                        <div class="case-info-grid">
                            <div class="case-info-cell">
                                <div class="case-info-label">分类信息</div>
                                <div class="case-info-value">
                                    <div class="case-info-field"><span class="case-info-field-name">Benchmark:</span><span class="case-info-field-value">${caseItem.benchmark || '-'}</span></div>
                                    <div class="case-info-field"><span class="case-info-field-name">Domain:</span><span class="case-info-field-value">${caseItem.domain || '-'}</span></div>
                                    <div class="case-info-field"><span class="case-info-field-name">SubCategory:</span><span class="case-info-field-value">${caseItem.subCategory || '-'}</span></div>
                                </div>
                            </div>
                            <div class="case-info-cell">
                                <div class="case-info-label">任务类型</div>
                                <div class="case-info-value">
                                    <div style="font-weight: 600; margin-bottom: 0.25rem;">${caseItem.taskType || '-'}</div>
                                    <div style="font-size: 0.8rem; color: var(--color-text-muted);">${caseItem.taskTypeDesc || ''}</div>
                                </div>
                            </div>
                            <div class="case-info-cell case-question-cell">
                                <div class="case-info-label">问题与答案</div>
                                <div class="case-info-value">
                                    <div class="case-question">Q: ${caseItem.question || '-'}</div>
                                    <div class="case-options">
                                        ${options.map(opt => {
                                            const optLetter = opt.charAt(0);
                                            const isCorrect = optLetter === answer;
                                            return `<div class="case-option${isCorrect ? ' correct' : ''}">${opt}</div>`;
                                        }).join('')}
                                    </div>
                                    <div class="case-abilities">
                                        <span class="case-abilities-label">所需能力:</span>
                                        ${(caseItem.abilities || []).map(a => `<span class="ability-tag" data-ability="${a}" onclick="filterByAbility('${a}', '${caseItem.id}')">${abilityFullNames[a] || a}</span>`).join('')}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="case-reasoning-section">
                        <div class="reasoning-grid">
                            <div class="reasoning-column">
                                <div class="reasoning-header">人类推理路径</div>
                                <div class="reasoning-content">${caseItem.humanReasoningSteps || '-'}</div>
                            </div>
                            <div class="reasoning-column">
                                <div class="reasoning-header">字幕内容</div>
                                <div class="reasoning-content${caseItem.subtitle ? '' : ' placeholder'}">${caseItem.subtitle || '暂无字幕'}</div>
                            </div>
                        </div>
                    </div>

                    <div class="plan-comparison-header">📊 Plan 轨迹对比</div>
                    <div class="case-plan-comparison" id="plan-compare-${caseItem.id}">
                    </div>
                </div>
            `;

            // 渲染 plan 对比列（exp_001_baseline 排在左边）
            const planContainer = card.querySelector(`#plan-compare-${caseItem.id}`);
            const sortedExps = [...experiments].sort((a, b) => a.id === 'exp_001_baseline' ? -1 : b.id === 'exp_001_baseline' ? 1 : 0);
            sortedExps.forEach(exp => {
                const expData = experimentResults[exp.id];
                const plan = expData?.results?.get(caseItem.id);
                const col = createPlanColumn(exp, plan, caseItem.id);
                planContainer.appendChild(col);
            });

            return card;
        }

        // ==================== Plan 结构化渲染 ====================
        function createPlanColumn(exp, plan, caseId) {
            const col = document.createElement('div');
            col.className = 'plan-column';
            col.dataset.experimentId = exp.id;
            const uniqueId = `${exp.id}-${caseId}`;
            const shortName = exp.name.includes('（') ? exp.name.split('（')[0] : exp.name;

            col.innerHTML = `
                <div class="plan-column-header">
                    <div class="plan-column-title-group">
                        <span class="plan-column-title">${shortName}</span>
                        <span class="plan-column-model">${exp.model}</span>
                    </div>
                    <div class="plan-view-toggle">
                        <button class="plan-view-btn active" onclick="switchPlanView('${uniqueId}', 'structured')">结构化</button>
                        <button class="plan-view-btn" onclick="switchPlanView('${uniqueId}', 'json')">JSON</button>
                    </div>
                </div>
                <div class="plan-column-body">
                    <div class="plan-structured-view" id="structured-${uniqueId}">
                        ${plan ? renderStructuredPlan(plan, caseId) : '<span class="placeholder">暂无数据</span>'}
                    </div>
                    <div class="plan-json-view" id="json-${uniqueId}"></div>
                </div>
            `;

            // 延迟初始化 renderjson（仅在切换时）
            if (plan) {
                col._planData = plan;
                col._uniqueId = uniqueId;
            }

            return col;
        }

        function renderStructuredPlan(plan, caseId) {
            let html = '';

            // 任务分析
            if (plan.task_analysis) {
                html += `<div class="plan-task-analysis">
                    <span class="plan-task-analysis-label">任务分析</span>
                    ${plan.task_analysis}
                </div>`;
            }

            // 执行步骤
            const ep = plan.execution_plan;
            if (ep && ep.steps && ep.steps.length > 0) {
                html += `<div class="plan-steps-header">执行计划 (${ep.total_steps || ep.steps.length} 步)</div>`;
                ep.steps.forEach((step, idx) => {
                    const toolName = step.tool?.name || '';
                    const tags = renderToolTags(toolName, caseId);
                    const isFirst = idx === 0;
                    const deps = step.dependencies && step.dependencies.length > 0
                        ? `<div class="plan-step-dep-label">依赖: ${step.dependencies.map(d => '&#9312;'.replace('&#9312;', circleNum(d))).join(' ')}</div>`
                        : '';

                    html += `
                    <div class="plan-step-card">
                        <div class="plan-step-card-header" onclick="toggleStepDetails(this)">
                            <div class="plan-step-card-title">
                                <span class="plan-step-num">${step.step_number}</span>
                                <span class="plan-step-tool-name">${toolName}</span>
                            </div>
                            ${tags ? `<div class="plan-step-tags">${tags}</div>` : ''}
                            <div class="plan-step-desc-text">${step.action_description || ''}</div>
                            ${deps}
                            <span class="plan-step-toggle">${isFirst ? '▾ 收起' : '▸ 详情'}</span>
                        </div>
                        <div class="plan-step-card-details${isFirst ? ' expanded' : ''}">
                            ${step.tool?.purpose ? `<div class="plan-step-detail-row"><span class="plan-step-detail-label">Purpose:</span><span class="plan-step-detail-value">${step.tool.purpose}</span></div>` : ''}
                            ${step.tool?.input_requirements ? `<div class="plan-step-detail-row"><span class="plan-step-detail-label">Inputs:</span><span class="plan-step-detail-value">${step.tool.input_requirements.map(i => '&bull; ' + i).join('<br>')}</span></div>` : ''}
                        </div>
                    </div>`;
                });

                // 工具链摘要
                const toolChain = ep.steps.map(s => s.tool?.name || '?').join(' → ');
                html += `<div class="plan-tool-chain-summary"><span class="label">工具链:</span>${toolChain}</div>`;
            }

            return html || '<span class="placeholder">暂无数据</span>';
        }

        function circleNum(n) {
            const circles = ['⓪','①','②','③','④','⑤','⑥','⑦','⑧','⑨','⑩'];
            return circles[n] || n;
        }

        function toggleStepDetails(header) {
            const details = header.nextElementSibling;
            const toggle = header.querySelector('.plan-step-toggle');
            if (details.classList.contains('expanded')) {
                details.classList.remove('expanded');
                toggle.textContent = '▸ 详情';
            } else {
                details.classList.add('expanded');
                toggle.textContent = '▾ 收起';
            }
        }

        function switchPlanView(uniqueId, view) {
            const structured = document.getElementById(`structured-${uniqueId}`);
            const jsonView = document.getElementById(`json-${uniqueId}`);
            const container = structured.closest('.plan-column');
            const btns = container.querySelectorAll('.plan-view-btn');

            if (view === 'json') {
                structured.classList.add('hidden');
                jsonView.classList.add('active');
                btns[0].classList.remove('active');
                btns[1].classList.add('active');
                // 延迟初始化：使用通用 JSON 视图工具
                const viewId = `plan-json-${uniqueId}`;
                if (!jsonViewRegistry[viewId]) {
                    const planData = container._planData;
                    if (planData) {
                        initJsonView(viewId, jsonView, planData, 2);
                    }
                }
            } else {
                structured.classList.remove('hidden');
                jsonView.classList.remove('active');
                btns[0].classList.add('active');
                btns[1].classList.remove('active');
            }
        }

        // ==================== 筛选 ====================
        function toggleFilter(btn) {
            const ability = btn.dataset.ability;
            if (selectedAbilities.has(ability)) {
                selectedAbilities.delete(ability);
                btn.classList.remove('active');
            } else {
                selectedAbilities.add(ability);
                btn.classList.add('active');
            }
            applyFilters();
        }

        function filterByAbility(ability, fromCaseId) {
            selectedAbilities.clear();
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            selectedAbilities.add(ability);
            const targetBtn = document.querySelector(`.filter-btn[data-ability="${ability}"]`);
            if (targetBtn) targetBtn.classList.add('active');
            applyFilters();
            document.getElementById('ability-filter').scrollIntoView({ behavior: 'smooth', block: 'center' });
            if (fromCaseId) showReturnButton(fromCaseId);
        }

        function clearFilters() {
            selectedAbilities.clear();
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            applyFilters();
        }

        function applyFilters() {
            const currentText = document.getElementById('filter-current-text');
            if (selectedAbilities.size === 0) {
                currentText.textContent = '无 (显示全部)';
            } else {
                currentText.textContent = [...selectedAbilities].map(a => abilityFullNames[a] || a).join(' + ');
            }
            filterPapers();
            filterCases();
            updateCounts();
        }

        function filterPapers() {
            document.querySelectorAll('.paper-card').forEach(paper => {
                if (selectedAbilities.size === 0) {
                    paper.classList.remove('hidden');
                    paper.querySelectorAll('.tool-card, .memory-card').forEach(c => c.classList.remove('highlighted'));
                    return;
                }
                let hasMatch = false;
                paper.querySelectorAll('.tool-card, .memory-card').forEach(card => {
                    const cardAbilities = JSON.parse(card.dataset.abilities || '[]');
                    const matches = [...selectedAbilities].every(a => cardAbilities.includes(a));
                    if (matches && cardAbilities.length > 0) {
                        card.classList.add('highlighted');
                        hasMatch = true;
                    } else {
                        card.classList.remove('highlighted');
                    }
                });
                paper.classList.toggle('hidden', !hasMatch);
            });
        }

        function filterCases() {
            document.querySelectorAll('.case-card').forEach(caseCard => {
                if (selectedAbilities.size === 0) {
                    caseCard.classList.remove('hidden');
                    return;
                }
                const caseAbilities = JSON.parse(caseCard.dataset.abilities || '[]');
                const matches = [...selectedAbilities].every(a => caseAbilities.includes(a));
                caseCard.classList.toggle('hidden', !matches);
            });
        }

        function updateCounts() {
            document.getElementById('paper-count').textContent = document.querySelectorAll('.paper-card:not(.hidden)').length;
            document.getElementById('case-count').textContent = document.querySelectorAll('.case-card:not(.hidden)').length;
        }

        // ==================== Side Navigation ====================
        function setupSideNav() {
            const sections = ['ability-overview', 'ability-filter', 'papers-section', 'cases-section'];
            const navItems = document.querySelectorAll('.side-nav-item');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const sectionId = entry.target.id;
                        navItems.forEach(item => {
                            item.classList.toggle('active', item.dataset.section === sectionId);
                        });
                    }
                });
            }, { root: null, rootMargin: '-20% 0px -60% 0px', threshold: 0 });

            sections.forEach(id => {
                const section = document.getElementById(id);
                if (section) observer.observe(section);
            });

            navItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    document.getElementById(item.dataset.section)?.scrollIntoView({ behavior: 'smooth', block: 'start' });
                });
            });
        }
        setupSideNav();

        // ==================== 图片 Modal ====================
        // ==================== URL 深度链接 + 复制 ====================
        function copySectionLink(sectionId, el) {
            const url = location.origin + location.pathname + '#' + sectionId;
            navigator.clipboard.writeText(url).then(() => {
                history.replaceState(null, '', '#' + sectionId);
                const original = el.textContent;
                el.textContent = '✓';
                setTimeout(() => { el.textContent = original; }, 1500);
            });
        }

        function copyCaseLink(caseId, el) {
            const url = location.origin + location.pathname + '#case-' + caseId;
            navigator.clipboard.writeText(url).then(() => {
                history.replaceState(null, '', '#case-' + caseId);
                const original = el.textContent;
                el.textContent = '✓';
                setTimeout(() => { el.textContent = original; }, 1500);
            });
        }

        function handleUrlHash() {
            const hash = location.hash;
            if (!hash) return;
            if (hash === '#cases') {
                setTimeout(() => {
                    document.getElementById('cases-section')?.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 100);
            } else if (hash.startsWith('#case-')) {
                const el = document.getElementById(hash.substring(1));
                if (el) {
                    setTimeout(() => {
                        el.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        el.classList.add('hash-highlight');
                        setTimeout(() => { el.classList.remove('hash-highlight'); }, 2000);
                    }, 100);
                }
            }
        }

        // ==================== 图片 Modal ====================
        function openImageModal(src) {
            const modal = document.getElementById('imageModal');
            document.getElementById('modalImage').src = src;
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeImageModal() {
            document.getElementById('imageModal').classList.remove('active');
            document.body.style.overflow = '';
        }

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeImageModal();
        });
    </script>
</body>

</html>
